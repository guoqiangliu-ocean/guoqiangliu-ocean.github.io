<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guoqiang Liu - Physical Oceanographer</title>

    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap');
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --gold: #FFD700;      /* 物理学配色 */
            --cyan: #7fdbff;      /* 海洋学配色 */
            --bg-dark: #050f1a;
        }

        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: "Inter", sans-serif;
            overflow: hidden;
            background-color: var(--bg-dark);
            color: #fff;
        }

        /* 视频背景 */
        #bg-video {
            position: fixed; top: 50%; left: 50%;
            min-width: 100%; min-height: 100%;
            width: auto; height: auto; z-index: -10;
            transform: translate(-50%, -50%);
            object-fit: cover;
            filter: brightness(0.4) contrast(1.1);
        }

        .video-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -9;
            background: radial-gradient(circle at center, rgba(5,15,26,0.1) 0%, rgba(5,15,26,0.8) 100%);
        }

        #spray-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -8; pointer-events: none;
        }

        /* 导航 */
        .topnav {
            position: fixed; top: 0; width: 100%; padding: 30px 50px;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
            box-sizing: border-box;
        }
        .brand { 
            font-family: "Playfair Display", serif; font-weight: 700; font-size: 1.4rem; letter-spacing: 2px; 
            text-transform: uppercase;
        }
        .nav-links a { 
            color: rgba(255,255,255,0.7); text-decoration: none; margin-left: 40px; 
            font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; 
        }
        .nav-links a:hover { color: var(--cyan); }

        /* 核心名片 */
        .main-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 1000px; z-index: 10; text-align: center;
        }
        .name-card {
            background: rgba(10, 20, 30, 0.4); 
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 60px 40px; border-radius: 4px;
            box-shadow: 0 40px 80px rgba(0,0,0,0.6);
            animation: fadeUp 1.2s cubic-bezier(0.2, 1, 0.3, 1) forwards;
        }
        .name-card h1 {
            font-family: "Playfair Display", serif; font-size: 5rem; margin: 0;
            letter-spacing: -1px; line-height: 1.1;
        }
        .subtitle {
            font-size: 1.1rem; color: #a0cbe0; margin-top: 15px;
            letter-spacing: 4px; text-transform: uppercase; font-weight: 300;
        }

        /* 访问计数显示 */
        .counter-box {
            margin-top: 30px; font-size: 0.75rem; color: rgba(255,255,255,0.4);
            letter-spacing: 1px; font-family: 'Inter';
        }

        /* 抽屉层样式 */
        .giants-drawer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #03080e; z-index: 200;
            transform: translateY(100%); transition: transform 0.8s cubic-bezier(0.7, 0, 0.3, 1);
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            overflow-y: auto; padding: 100px 0;
        }
        .giants-drawer.open { transform: translateY(0); }

        /* 地图容器 */
        #visitor-map {
            width: 85%; max-width: 900px; height: 350px;
            margin: 40px 0; border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 4px; background: #050f1a;
        }

        /* 脉冲点动画 */
        .pulse-icon {
            background: var(--gold); border-radius: 50%;
            box-shadow: 0 0 0 rgba(255, 215, 0, 0.8);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .close-btn {
            position: fixed; top: 40px; right: 60px; background: none; border: none;
            color: rgba(255,255,255,0.3); font-size: 3rem; cursor: pointer; z-index: 201;
        }

        .scientists-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px 100px; text-align: center;
        }
        .name-only-card .name {
            font-family: "Playfair Display", serif; font-size: 2.5rem;
            color: rgba(255,255,255,0.2); transition: 0.5s;
        }
        .name-only-card:hover .name { color: #fff; transform: scale(1.05); }

        .corner-trigger { position: fixed; bottom: 50px; right: 50px; z-index: 50; }
        .legacy-btn {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 0.6);
            padding: 15px 30px; border-radius: 50px; cursor: pointer; font-family: "Playfair Display";
            transition: 0.4s;
        }
        .legacy-btn:hover { border-color: #fff; color: #fff; transform: translateY(-3px); }

        @keyframes fadeUp { from {opacity:0; transform: translateY(40px);} to {opacity:1; transform: translateY(0);} }
    </style>
</head>
<body>

<video autoplay muted loop playsinline id="bg-video">
    <source src="https://videos.pexels.com/video-files/855018/855018-hd_1920_1080_30fps.mp4" type="video/mp4">
</video>
<div class="video-overlay"></div>
<canvas id="spray-canvas"></canvas>

<nav class="topnav">
    <div class="brand">G. Liu</div>
    <div class="nav-links">
        <a href="#">Research</a><a href="#">Publications</a><a href="#">CV</a>
    </div>
</nav>

<div class="main-container">
    <div class="name-card">
        <h1>Guoqiang Liu</h1>
        <div class="subtitle">Physical Oceanographer</div>
        <div class="counter-box">
            <span id="visitor-ip">INITIALIZING SENSOR...</span> 
            <span style="margin: 0 15px; opacity: 0.3;">|</span>
            STATION ACCESS: <span id="busuanzi_value_site_pv" style="color: var(--gold);">..</span>
        </div>
    </div>
</div>

<div class="corner-trigger">
    <button class="legacy-btn" onclick="toggleDrawer()">Standing on the Shoulders of Giants</button>
</div>

<div class="giants-drawer" id="giantsDrawer">
    <button class="close-btn" onclick="toggleDrawer()">×</button>
    
    <div id="visitor-map"></div>
    <div id="map-status" style="font-size: 0.7rem; color: var(--cyan); letter-spacing: 2px; margin-bottom: 50px;">CONNECTING TO GLOBAL NODES...</div>

    <div class="scientists-grid">
        <div class="name-only-card"><div class="name">Albert Einstein</div></div>
        <div class="name-only-card"><div class="name">Ludwig Boltzmann</div></div>
        <div class="name-only-card"><div class="name">Walter Munk</div></div>
        <div class="name-only-card"><div class="name">Andrey Kolmogorov</div></div>
    </div>
</div>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>
let map;

// 1. 抽屉开关逻辑
function toggleDrawer() {
    const drawer = document.getElementById('giantsDrawer');
    drawer.classList.toggle('open');
    if (drawer.classList.contains('open')) {
        setTimeout(() => {
            if (!map) { trackVisitor(); } 
            else { map.invalidateSize(); }
        }, 850);
    }
}

// 2. 地图与 IP 追踪
async function trackVisitor() {
    try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        const { latitude, longitude, city, country_name, ip } = data;

        // 更新首页 IP 显示
        document.getElementById('visitor-ip').innerText = `SIGNAL FROM: ${city.toUpperCase()} [${ip}]`;
        document.getElementById('map-status').innerText = `NODE ACTIVE: ${city}, ${country_name}`;

        // 初始化地图
        if (!map) {
            map = L.map('visitor-map', { center: [latitude, longitude], zoom: 3, zoomControl: false, attributionControl: false });
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        }

        const pulseIcon = L.divIcon({ className: 'pulse-icon', iconSize: [12, 12] });
        L.marker([latitude, longitude], { icon: pulseIcon }).addTo(map)
            .bindPopup(`<span style="color:#000">${city}</span>`).openPopup();
        
        map.flyTo([latitude, longitude], 4);
    } catch (e) {
        document.getElementById('visitor-ip').innerText = "OFFLINE MODE";
    }
}

// 3. 海面飞沫 Canvas 动画 (保持原有逻辑)
const canvas = document.getElementById('spray-canvas');
const ctx = canvas.getContext('2d');
let w, h, particles = [];
function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();

class Particle {
    constructor() { this.init(); }
    init() {
        this.x = Math.random() * w; this.y = Math.random() * h;
        this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.3;
        this.size = Math.random() * 2; this.alpha = 0; this.life = 0; this.maxLife = 100 + Math.random() * 200;
    }
    update() {
        this.x += this.vx; this.y += this.vy; this.life++;
        if (this.life < 50) this.alpha = this.life / 50 * 0.2;
        else if (this.life > this.maxLife - 50) this.alpha = (this.maxLife - this.life) / 50 * 0.2;
        if (this.life > this.maxLife || this.x < 0 || this.x > w || this.y < 0 || this.y > h) this.init();
    }
    draw() {
        ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(200, 240, 255, ${this.alpha})`; ctx.fill();
    }
}
for(let i=0; i<150; i++) particles.push(new Particle());
function animate() {
    ctx.clearRect(0, 0, w, h);
    particles.forEach(p => { p.update(); p.draw(); });
    requestAnimationFrame(animate);
}
animate();
trackVisitor(); // 初始加载即获取 IP
</script>

</body>
</html>
